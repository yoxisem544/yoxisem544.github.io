{"componentChunkName":"component---src-templates-blog-post-js","path":"/bitrise-cache/","webpackCompilationHash":"060afc7a824299ecc33f","result":{"data":{"site":{"siteMetadata":{"title":"Hello Swift!","author":"David Lin"}},"markdownRemark":{"id":"f86b644d-4557-5bbd-a9d0-41d3cf2c558d","html":"<p>最近因為公司專案緣故深入研究了 Bitrise CI 的 cache 機制，目的是想要降低每次 commit check 的時候都要重新安裝一遍 dependencies，如 gem, homebrew, mint, pods 等等。如果是架在 Jenkins 上就會單純很多，只要管理好跑 Jenkins 的電腦上的環境即可（這裡就只專注在 Bitrise 上）。</p>\n<h2 id=\"套件管理工具\"><a href=\"#%E5%A5%97%E4%BB%B6%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>套件管理工具</h2>\n<p>我們希望公司內每個 iOS 的開發環境一致，所以我們使用了以下幾個套件管理工具：</p>\n<ol>\n<li>rbenv：管理 ruby 版本。</li>\n<li>bundler：管理專案中 gem 的路徑，我們將它裝在 ./vendor/bundle 目錄底下，如此一來 ci 或其他開發者可以透過 bundle exec 來執行安裝在 working directory 底下的 gem，就不會因為 gem 版本不一樣而打架了。</li>\n<li>mint：管理 SwiftLint &#x26; SwiftFormat 版本，由於 linter 每個版本的規則會略有增減，不同版本的 linter 會造成規則不同的錯誤。</li>\n<li>cocoapods：可以透過 bundler 管理，大家應該都很熟悉，就不贅述了。</li>\n</ol>\n<h2 id=\"在尚未-cache-前\"><a href=\"#%E5%9C%A8%E5%B0%9A%E6%9C%AA-cache-%E5%89%8D\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>在尚未 cache 前</h2>\n<p align=\"center\">\n  <a class=\"gatsby-resp-image-link\" href=\"/static/343dc45ee064b7dbd11cfd8db61c78b2/da6b3/img1.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n  \n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 68.29608938547487%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAABpUlEQVQ4y41UWXaCQBDkRGyiRhMVBEFccGNziTH3P0SnqwcVE57xo177Zqmp6mrUDG9L5nhHurslw9uRyajXVpBTa5KTExbkcDWrvToM3HUVj2b7KR8sqM0XbD8ja5yS5aVScaA/P9L74kSj1YWGyZksX+3Va7t6DFXDYjfe02B9JicuyJzwoZCJA3UBDgC9UiEkv4CHvM039WdHRdielmTMMjIXTDRnW8ucrIh/s50HRX7aSAgXg+VZEaJPNisyopT0KfcyYgw3pI9qcJ9hS93pnnpMBtuisBOXZLMyKynuWOSiVpTWFfqPapFBf44ef9FbfGBCXxGCAFZNWOe1G6pwVL3jGhrqOxO66wv1boSzPdmrShXUhdljn/xnCjPpHXrYiUrS8EoryiUUI+ZUp6maK+919GYHGS2xDEInKsQqCKUGu8YB/jPQqHwfVpG0KLz3kK3CNkYmaB6PJqhQlGU12L6aQzNh2wkCUZ8SFLxKOFh+Sii3lD94obtk2cmJOmEpXw7kX1N8Cjjks5jFWygYym60l7SwgZeEsOrRfzCqPwiQ/wDBa/Zkmcja2wAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\">\n      <img class=\"gatsby-resp-image-image\" style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\" alt=\"img1\" title src=\"/static/343dc45ee064b7dbd11cfd8db61c78b2/b9e4f/img1.png\" srcset=\"/static/343dc45ee064b7dbd11cfd8db61c78b2/cf440/img1.png 148w,\n/static/343dc45ee064b7dbd11cfd8db61c78b2/d2d38/img1.png 295w,\n/static/343dc45ee064b7dbd11cfd8db61c78b2/b9e4f/img1.png 590w,\n/static/343dc45ee064b7dbd11cfd8db61c78b2/f9b6a/img1.png 885w,\n/static/343dc45ee064b7dbd11cfd8db61c78b2/2d849/img1.png 1180w,\n/static/343dc45ee064b7dbd11cfd8db61c78b2/da6b3/img1.png 1432w\" sizes=\"(max-width: 590px) 100vw, 590px\">\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>可以看到 bundle install、Brew Install、Mint Bootstrap 都會耗上幾分鐘的時間去安裝，如果可以讓這些重複執行的動作可以被 cache 住，下次執行時直接從 cache 抓，速度會變的更快！ </p>\n<hr>\n<h3 id=\"bitrise-cache-機制\"><a href=\"#bitrise-cache-%E6%A9%9F%E5%88%B6\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Bitrise Cache 機制</h3>\n<p>Bitrise 使用了自家的 cache 機制，你可以在 workflow editor 中找到 cache-pull/cache-push 兩個 step</p>\n<p align=\"center\">\n  <a class=\"gatsby-resp-image-link\" href=\"/static/16bbac08b048615ecaf079a77c074daa/97281/img4.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n  \n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 34.77088948787062%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABLklEQVQoz21RTUsDMRDtz/cgePBo8Vi0BwuCKGgRBCtaamupWKwodbvpfmJ387kefGZSd12lh5eZTCYvb14aSis8RH30w2tM0wm0Nsiz3IHnHJwLF3MC1SxSwfEhBbRSUP/Q4CrH4es+mrMdnM6PYIxBwCKwRYClHyKOErsPsaS9racWN2mMEV/hqyigbT/d0Vr/Ep6wNtqLJs7ZsX3VQAhSxl1THaZ2eRMcIS3jp0f0BneYvszcAY0nhADZIaV0oD6qrXMJ/pOLWlwrzATO9u7R2b7FZWuM4tO4UX1v6RAFsRvff2euzuYMXpygu0qQW4Kiprgi7Oz2cLB1hW5r6A5o3MyaXyojVLm0Sm2MrMrSvz8eUsOk94bBxTNmQ68iJB/Vhl8sYRy5rCwpH/wGRLQOc3mK/TUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\">\n      <img class=\"gatsby-resp-image-image\" style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\" alt=\"img4\" title src=\"/static/16bbac08b048615ecaf079a77c074daa/b9e4f/img4.png\" srcset=\"/static/16bbac08b048615ecaf079a77c074daa/cf440/img4.png 148w,\n/static/16bbac08b048615ecaf079a77c074daa/d2d38/img4.png 295w,\n/static/16bbac08b048615ecaf079a77c074daa/b9e4f/img4.png 590w,\n/static/16bbac08b048615ecaf079a77c074daa/97281/img4.png 742w\" sizes=\"(max-width: 590px) 100vw, 590px\">\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>在你要安裝任何 dependency 之前，或者執行 fastlane 以前，可以透過 cache-pull 將暫存的 cache 檔案抓下來。然後在每次結束 task 之前，將有更動或更新的 dependency 透過 cache-push 在存起來。</p>\n<hr>\n<h3 id=\"cache-gem--bundler\"><a href=\"#cache-gem--bundler\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cache Gem &#x26; Bundler</h3>\n<p>由於 Bitrise 本身使用 rbenv 管理 ruby 版本，所以我們可以在專案中建立 .ruby-version 指定要使用的 ruby 版本，在此我在 .ruby-version 中指定使用 2.6.5 版本的 ruby。</p>\n<p>再來我們不希望把安裝好的 gem commit 上 github，所以這裡使用</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">bundle config <span class=\"token builtin class-name\">set</span> path <span class=\"token string\">'vendor/bundle'</span></code></pre></div>\n<p>指定 bundler 要安裝 gem 的路徑，並且透過 .gitignore 忽略掉。</p>\n<hr>\n<p>回到 Bitrise 的 Workflow editor 新增一個 run script 如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">script@1</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">title</span><span class=\"token punctuation\">:</span> Bundle Install\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">content</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token punctuation\">-</span>\n        bundle i</code></pre></div>\n<blockquote>\n<blockquote>\n<blockquote>\n<p><code class=\"language-text\">bundle i</code> 是 <code class=\"language-text\">bundle install</code> 的縮寫</p>\n</blockquote>\n</blockquote>\n</blockquote>\n<p>如果不清楚要加在哪裡的話，會是在 Script content 那一欄：</p>\n<p align=\"center\">\n  <a class=\"gatsby-resp-image-link\" href=\"/static/ba57139958510264ff7681de1c683a35/ddb0f/img2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n  \n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 42.10526315789473%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA8UlEQVQoz42RzUrEMBSF+/Ku3PgWLlz4DoI4MBs3ymxcjBanadOkSZqmP7RnegIdZkBsAx+30JvDd0iilIKUEkor/H4LPD/s8HT/ise7F3y9n8AzTRO2nsR7j7quwWkqh8P+B5+7Iz7ejlDCzmEj+r7HMAz/wp1xHJEwrCzLiCwlnDfQRiL0Hk3wcNYhhLBK0zQxNNFaI01TsDpDtdIoimL+VrOxgbUWbduuwtAYWFUVhBBgsHPuUqHrugtcXi79xfKPu7Eyg4wxEVpyXgesmXGyMkWiYZZlEb42J20Xsy3cVKZNnufRcnnN65pboSHvnQF1RWibAOQUkwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\">\n      <img class=\"gatsby-resp-image-image\" style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\" alt=\"img2\" title src=\"/static/ba57139958510264ff7681de1c683a35/b9e4f/img2.png\" srcset=\"/static/ba57139958510264ff7681de1c683a35/cf440/img2.png 148w,\n/static/ba57139958510264ff7681de1c683a35/d2d38/img2.png 295w,\n/static/ba57139958510264ff7681de1c683a35/b9e4f/img2.png 590w,\n/static/ba57139958510264ff7681de1c683a35/f9b6a/img2.png 885w,\n/static/ba57139958510264ff7681de1c683a35/ddb0f/img2.png 988w\" sizes=\"(max-width: 590px) 100vw, 590px\">\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>並且在 cache-push 的 cache-paths 增加：</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">cache-push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">cache_paths</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token punctuation\">-</span>\n        <span class=\"token comment\"># 記得把註解拿掉，bitrise 不會忽略註解，會造成路徑錯誤</span>\n        $GEM_CACHE_PATH <span class=\"token punctuation\">-</span><span class=\"token punctuation\">></span> ./.ruby<span class=\"token punctuation\">-</span>version <span class=\"token comment\"># 官方文件的環境變數</span>\n        ./vendor <span class=\"token punctuation\">-</span><span class=\"token punctuation\">></span> ./Gemfile.lock <span class=\"token comment\"># 當 gemfile lock 有變化時，更新 ./vendor 底下的 cache</span></code></pre></div>\n<p>當你看到以下結果時表示 gem 有成功的被 cache 住了：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">bundle i\n+ bundle i\nUsing CFPropertyList 3.0.2\nUsing concurrent-ruby 1.1.6\n...\nBundle complete! 3 Gemfile dependencies, 83 gems now installed.\nBundled gems are installed into `./vendor/bundle`</code></pre></div>\n<hr>\n<h3 id=\"cache-homebrew--mint\"><a href=\"#cache-homebrew--mint\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cache Homebrew &#x26; Mint</h3>\n<p>官方推薦的方法是使用 Brew install 直接安裝需要的套件，再將 cache 打開即可。但其實有更好的方式，因為 Bitrise 內建 brew 所以我們不需要重新安裝一次，也可以透過 run script 的方式直接 <code class=\"language-text\">brew install xxx</code>。</p>\n<p>這裡我們要做的事是把 brew 安裝套件的位置抓出來，安裝好之後透過 cache-push 做好 cache，等之後 cache-pull 時可以直接把曾經安裝好的 brew 套件裝回來，第二次執行 brew install 的時候透過 link 的方式直接 link 到 cache 裡的套件。</p>\n<p>所以這裡我們有幾件事要做：</p>\n<ol>\n<li>先設定要 cache 的 brew 套件環境變數</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">title</span><span class=\"token punctuation\">:</span> Set Env Path\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">content</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token punctuation\">-</span>\n        <span class=\"token comment\"># 增加我們要 cache 的 brew 套件環境變數，如果有使用到其他的套件，請再手動增加</span>\n        envman add <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>key BREW_MINT <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>value \"$(brew <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>cellar)/mint\" <span class=\"token comment\"># 指定套件名稱位置</span>\n        envman add <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>key BREW_OPT_MINT <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>value \"/usr/local/opt/mint\"  <span class=\"token comment\"># 指定套件名稱位置，此為 file alias</span></code></pre></div>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>echo ”$(brew —cellar)” 可以取得 brew 安裝套件位置</p>\n</blockquote>\n</blockquote>\n</blockquote>\n<ol start=\"2\">\n<li>手動執行 Brew Install</li>\n</ol>\n<p>由於我們不走 Bitrise 提供給我們的 Brew Install，在此我們要新增一個 run script：</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">title</span><span class=\"token punctuation\">:</span> Brew install\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">content</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token punctuation\">-</span>\n        <span class=\"token comment\"># 執行上述的 install 方法，沒有套件則先安裝，有的話直接 link cache 中的套件</span>\n        brew install mint\n        brew link mint</code></pre></div>\n<ol start=\"3\">\n<li>記得新增 cache-paths</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">cache-push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">cache_paths</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token punctuation\">-</span>\n        $BITRISE_CACHE_DIR\n        <span class=\"token punctuation\">...</span>\n\n        <span class=\"token comment\"># 新增以下 cache_path</span>\n        $BREW_MINT\n        $BREW_OPT_MINT</code></pre></div>\n<p>成功後就會看到</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">+ brew install mint\nWarning: mint 0.14.2 is already installed, it&#39;s just not linked\nYou can use `brew link mint` to link this version.\n+ brew link mint\nLinking /usr/local/Cellar/mint/0.14.2... 1 symlinks created</code></pre></div>\n<hr>\n<h3 id=\"cache-swiftlint--swiftformat\"><a href=\"#cache-swiftlint--swiftformat\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cache SwiftLint &#x26; SwiftFormat</h3>\n<p>再來執行 task 時會發現每次 mint 要 bootstrap 把需要的套件安裝起來後，每次都要等很久，是因為 cache brew 套件並不會把 mint 安裝過的套件也一併 cache 住。</p>\n<p>原因是 mint 把透過 mint 安裝的套件安裝在 <code class=\"language-text\">/usr/local/lib/mint</code> 底下，所以我們可以在上面設定環境變數的地方再加上</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\">envman add <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>key MINT_PACKAGES <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>value \"/usr/local/lib/mint\"</code></pre></div>\n<p>然後在 cache-push 的 cache-paths 新增：</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">cache-push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">cache_paths</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token punctuation\">-</span>\n        <span class=\"token punctuation\">...</span>\n\n        <span class=\"token comment\"># 新增</span>\n        $MINT_PACKAGES</code></pre></div>\n<p>成功後就會看到：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">+ mint bootstrap\n🌱 2 packages up to date</code></pre></div>\n<p>Mint 不會再 compile 一次浪費時間。</p>\n<hr>\n<h3 id=\"結果比較\"><a href=\"#%E7%B5%90%E6%9E%9C%E6%AF%94%E8%BC%83\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>結果比較</h3>\n<p>原先要執行 15.8 分鐘</p>\n<p align=\"center\">\n  <a class=\"gatsby-resp-image-link\" href=\"/static/343dc45ee064b7dbd11cfd8db61c78b2/da6b3/img1.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n  \n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 68.29608938547487%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAABpUlEQVQ4y41UWXaCQBDkRGyiRhMVBEFccGNziTH3P0SnqwcVE57xo177Zqmp6mrUDG9L5nhHurslw9uRyajXVpBTa5KTExbkcDWrvToM3HUVj2b7KR8sqM0XbD8ja5yS5aVScaA/P9L74kSj1YWGyZksX+3Va7t6DFXDYjfe02B9JicuyJzwoZCJA3UBDgC9UiEkv4CHvM039WdHRdielmTMMjIXTDRnW8ucrIh/s50HRX7aSAgXg+VZEaJPNisyopT0KfcyYgw3pI9qcJ9hS93pnnpMBtuisBOXZLMyKynuWOSiVpTWFfqPapFBf44ef9FbfGBCXxGCAFZNWOe1G6pwVL3jGhrqOxO66wv1boSzPdmrShXUhdljn/xnCjPpHXrYiUrS8EoryiUUI+ZUp6maK+919GYHGS2xDEInKsQqCKUGu8YB/jPQqHwfVpG0KLz3kK3CNkYmaB6PJqhQlGU12L6aQzNh2wkCUZ8SFLxKOFh+Sii3lD94obtk2cmJOmEpXw7kX1N8Cjjks5jFWygYym60l7SwgZeEsOrRfzCqPwiQ/wDBa/Zkmcja2wAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\">\n      <img class=\"gatsby-resp-image-image\" style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\" alt=\"img1\" title src=\"/static/343dc45ee064b7dbd11cfd8db61c78b2/b9e4f/img1.png\" srcset=\"/static/343dc45ee064b7dbd11cfd8db61c78b2/cf440/img1.png 148w,\n/static/343dc45ee064b7dbd11cfd8db61c78b2/d2d38/img1.png 295w,\n/static/343dc45ee064b7dbd11cfd8db61c78b2/b9e4f/img1.png 590w,\n/static/343dc45ee064b7dbd11cfd8db61c78b2/f9b6a/img1.png 885w,\n/static/343dc45ee064b7dbd11cfd8db61c78b2/2d849/img1.png 1180w,\n/static/343dc45ee064b7dbd11cfd8db61c78b2/da6b3/img1.png 1432w\" sizes=\"(max-width: 590px) 100vw, 590px\">\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>變成只要 6.4 分鐘</p>\n<p align=\"center\">\n  <a class=\"gatsby-resp-image-link\" href=\"/static/d73a15ff9488b54b5a44919f334aa8a8/e9603/img3.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n  \n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 80.80229226361033%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB2ElEQVQ4y41U6XqCQBDjhcqh1tZeIkLlUGwRQXvZ93+JaTK7Hq1+1R9x+WQ3m8xkcPxoIUFUizeqhM+H4P836Vr6k5Wu18+t+KPF0T5vZMD9Dn868VK6cSN+iBdhJd6w0pWHSXSbreVh9on1Tdzhq16uCI0Ing/GNTiW4nTwMCje5fF1I91JI0GClykQ13qjKlIF5gIe3AHve1A9nG8UvNAh+3W+Em+6FH8GwqlFggMjc0gxPni2oLpe0sgdBcEB3TjcSMIgh2USZVAXHSsxBHtsCbsg1JJMP7XWDm10nhtx01rcHMiAAkgX4k6AqNK6ueFfVHKF/0lMItqlWrXcL9bSmbXGatbsLZ4Da5i0Msjf5ancGMtKmK8lKBGJ0tg2cahP4Hek6I6qmIDw5VvuQIwuW4VzqxDE2unoUoWN1m+nUAuLuHiprVsCIIes0VmwhuN6F3ytoXY5Q5cLWC0QnRyI65MTcQTs4UCQ7L74MF3eNiVgU0prOT7O3ClsczjI3+TpMNjaFNbwpdU8aqDHlxNS3WP5hVlfGcu9tNXuerRrh/2sXbuvayeFpBxDJeynZlKCyb672+H/D2wM9/MrxPppU1jU4fxbbwixmrn80k2XBty3meTX5ge7ND30qmSsAgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\">\n      <img class=\"gatsby-resp-image-image\" style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\" alt=\"img3\" title src=\"/static/d73a15ff9488b54b5a44919f334aa8a8/b9e4f/img3.png\" srcset=\"/static/d73a15ff9488b54b5a44919f334aa8a8/cf440/img3.png 148w,\n/static/d73a15ff9488b54b5a44919f334aa8a8/d2d38/img3.png 295w,\n/static/d73a15ff9488b54b5a44919f334aa8a8/b9e4f/img3.png 590w,\n/static/d73a15ff9488b54b5a44919f334aa8a8/f9b6a/img3.png 885w,\n/static/d73a15ff9488b54b5a44919f334aa8a8/2d849/img3.png 1180w,\n/static/d73a15ff9488b54b5a44919f334aa8a8/e9603/img3.png 1396w\" sizes=\"(max-width: 590px) 100vw, 590px\">\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ul>\n<li>Bundle install 2.7 min -> 2.8 sec</li>\n<li>Mint Bootstrap 6.4 min -> 1.72 sec</li>\n</ul>\n<p>每次 commit push 都可以省下將近 10 分鐘的時間，長久累積下來絕對不是個小數目。</p>\n<hr>\n<h3 id=\"參考資源\"><a href=\"#%E5%8F%83%E8%80%83%E8%B3%87%E6%BA%90\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>參考資源</h3>\n<p><a href=\"https://qiita.com/Kazuma_Nagano/items/502c1733f1b6da3a9073\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">[iOS] Bitriseのキャッシュをできるだけ生かしてCI / CDの高速化を図る - @Kazuma_Nagano</a></p>\n<p><a href=\"https://qiita.com/yosshi4486/items/cca97bf84e0be71569ee_\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Bitriseで gemとbrewのキャッシュ - @yosshi4486</a></p>","timeToRead":4,"frontmatter":{"title":"Bitrise Cache","date":"June 30, 2020","spoiler":"How to speed up dependency installation?"},"fields":{"slug":"/bitrise-cache/","langKey":"en"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/bitrise-cache/","previous":{"fields":{"slug":"/api-kit/","langKey":"en","directoryName":"api-kit","maybeAbsoluteLinks":[]},"frontmatter":{"title":"RESTful API and OAuth 2.0"}},"next":null,"translations":[],"translatedLinks":[]}}}